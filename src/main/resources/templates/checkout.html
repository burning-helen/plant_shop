<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Оформление заказа</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-5">
  <h2>Оформление заказа</h2>

  <!-- Форма заказа -->
  <form id="orderForm" th:action="@{/checkout}" method="post" th:object="${orderForm}">
    <div class="mb-3">
      <label for="deliveryAddress" class="form-label">Адрес доставки</label>
      <textarea class="form-control" id="deliveryAddress" th:field="*{deliveryAddress}" required></textarea>
    </div>

    <div class="mb-3">
      <label for="paymentMethod" class="form-label">Способ оплаты</label>
      <select class="form-select" id="paymentMethod" th:field="*{paymentMethod}" required>
        <option value="" disabled selected>Выберите</option>
        <option value="Карта">Карта</option>
        <option value="Наличные">Наличные</option>
      </select>
    </div>

    <button type="submit" class="btn btn-success">Подтвердить заказ</button>
    <a href="/cart" class="btn btn-outline-secondary">Вернуться в корзину</a>
  </form>

  <!-- Блок благодарности -->
  <div id="thankYouBlock" class="text-center mt-5 d-none">
    <h3 class="mb-4 text-success">Спасибо за заказ!</h3>
    <div class="d-flex justify-content-center gap-3">
      <a href="/catalog" class="btn btn-primary">К каталогу</a>
      <a href="/user_orders" class="btn btn-outline-secondary">История заказов</a>
    </div>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const form = document.getElementById("orderForm");
    const thankYouBlock = document.getElementById("thankYouBlock");

    form.addEventListener("submit", function (e) {
      e.preventDefault();

      const formData = new FormData(form);

      fetch(form.action, {
        method: "POST",
        body: formData,
      })
              .then(response => {
                if (response.redirected || response.ok) {
                  // Успешно — скрыть форму, показать сообщение
                  form.classList.add("d-none");
                  thankYouBlock.classList.remove("d-none");
                } else {
                  alert("Произошла ошибка при оформлении заказа.");
                }
              })
              .catch(error => {
                console.error("Ошибка:", error);
                alert("Произошла ошибка при оформлении заказа.");
              });
    });
  });
</script>
</body>
</html>
